<! DOCTYPE html>
<html>
<head>
<title>DAT Colors</title>

<script type='text/javascript' src='bower_components/jquery/dist/jquery.js'></script>
<script type='text/javascript' src='bower_components/raphael/raphael.js'></script>
<script type='text/javascript' src='bower_components/underscore/underscore.js'></script>

<script type='text/javascript' src='lib/zi.js'></script>
<script type='text/javascript' src='lib/darwa.js'></script>

<script type='text/javascript'>

  var evo = {};
  evo.genePool = [];
  evo.sex = true;
  evo.generations = 20;
  evo.Scheme = function(){
    var colors = [];
    var delta = 0.3;
    if (this.genePool.length>3){
      if (this.sex = true){
        var mom = _.sample(this.genePool).slice();
        var dad = _.sample(this.genePool).slice();
        var childLength = Math.random()>0.5 ? mom.length : dad.length;
        for (var i=0;i<childLength;i++){
          var locus = Math.random()>0.5 ? mom[i] : dad[i];
          locus !== undefined ? colors.push(darwa.rgb(locus,delta)) : null;
        }
      } else {
        colors = _.sample(this.genePool).slice();
        for (var i=0;i<colors.length;i++){
          colors[i] = darwa.rgb(colors[i],delta);
        }
      }
    } else {
        for (var i=0;i<2+_.random(2);i++){
            colors.push(darwa.rgb() );
        }
    }
    if (this.genePool.length>this.generations){this.genePool.shift();}
    
    return colors;
  };

  var app = {};
  app.init=function(target){
    this.generateColorScheme();
    this.displaySelectedColors(target);
  };
  
  app.selection=null;
  app.generateColorScheme = function(){
      this.selection = evo.Scheme();
      return this.selection;
  };
  app.displaySelectedColors = function(target){
    target.clear();
      for (var i=0;i<this.selection.length;i++){
          target.circle(30+i*50,30+i,20).attr({fill:this.selection[i]});
      }
  };
  

  $(document).ready(function(){
      zi.css();
      var selectionCanvas = new Raphael('selection',500,300);
      var selectionCanvasDimensions = {};
      selectionCanvasDimensions.width = $("#selection").innerWidth();
      selectionCanvasDimensions.height = $("#selection").innerHeight();
      
      var genePoolCanvas = new Raphael('gene-pool',500,3000);
      
      app.init(selectionCanvas);
      
      //listeners
      $("input[type=button]#live").on("click",function(){
        evo.genePool.push(app.selection);
        app.generateColorScheme();
        app.displaySelectedColors(selectionCanvas);
      });
      $("input[type=button]#die").on("click",function(){
        app.generateColorScheme();
        app.displaySelectedColors(selectionCanvas);
      });
  });
</script>

</head>
<body >
  <h2>Current Generation</h2>
  <div id='canvas'></div>
  <div id='selection'>
      <input type='button' id='live' value='I Like It!'></input>
      <input type='button' id='die' value='Next'></input>
  </div>
  <h2>the gene pool</h2>
  <div id='gene-pool'></div>
  <h1>Darwin Among the Colors</h1>
</body>
</html>